{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://tori.ai/schemas/psi_event.schema.json",
  "title": "PsiEvent",
  "description": "Extended PsiArchive event with rich provenance tracking",
  "type": "object",
  "required": ["event_id", "event_type", "timestamp"],
  "properties": {
    "event_id": {
      "type": "string",
      "description": "Unique event identifier",
      "pattern": "^evt_.*"
    },
    "event_type": {
      "type": "string",
      "description": "Type of event",
      "enum": [
        "LEARNING_UPDATE",
        "RESPONSE_EVENT",
        "PLAN_CREATION",
        "PENROSE_SIM",
        "SEAL_EVENT",
        "SNAPSHOT_EVENT"
      ]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp",
      "format": "date-time"
    },
    "parent_id": {
      "type": ["string", "null"],
      "description": "Event that caused this event"
    },
    "source_doc_sha": {
      "type": ["string", "null"],
      "description": "SHA-256 hash of source document",
      "pattern": "^[a-f0-9]{64}$"
    },
    "concept_ids": {
      "type": "array",
      "description": "Concepts touched by this event",
      "items": {
        "type": "string"
      }
    },
    "session_id": {
      "type": ["string", "null"],
      "description": "Chat or ingestion session ID"
    },
    "thread_id": {
      "type": ["string", "null"],
      "description": "Plan/debate chain ID"
    },
    "mesh_delta": {
      "type": ["object", "null"],
      "description": "Added nodes and edges",
      "properties": {
        "added_nodes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "name"],
            "properties": {
              "id": {"type": "string"},
              "name": {"type": "string"},
              "category": {"type": "string"},
              "importance": {"type": "number"},
              "metadata": {"type": "object"}
            }
          }
        },
        "added_edges": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["source", "target", "relation_type"],
            "properties": {
              "source": {"type": "string"},
              "target": {"type": "string"},
              "relation_type": {"type": "string"},
              "strength": {"type": "number"},
              "metadata": {"type": "object"}
            }
          }
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Semantic tags for filtering",
      "items": {
        "type": "string"
      }
    },
    "penrose_stats": {
      "type": ["object", "null"],
      "description": "Penrose similarity computation statistics",
      "properties": {
        "n_concepts": {"type": "integer"},
        "n_edges": {"type": "integer"},
        "rank": {"type": "integer"},
        "threshold": {"type": "number"},
        "density_pct": {"type": "number"},
        "speedup_vs_full": {"type": "number"},
        "times": {
          "type": "object",
          "properties": {
            "projection": {"type": "number"},
            "similarity": {"type": "number"},
            "sparsification": {"type": "number"},
            "total": {"type": "number"}
          }
        },
        "csr_file": {"type": "string"},
        "compression": {
          "type": "object",
          "properties": {
            "original_bytes": {"type": "integer"},
            "compressed_bytes": {"type": "integer"},
            "compression_ratio": {"type": "number"}
          }
        },
        "relations": {
          "type": "object",
          "properties": {
            "relations_added": {"type": "integer"},
            "relations_skipped": {"type": "integer"}
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional event-specific metadata",
      "additionalProperties": true
    }
  },
  "examples": [
    {
      "event_id": "evt_2025-01-10T14:23:45.123456_a1b2c3d4",
      "event_type": "LEARNING_UPDATE",
      "timestamp": "2025-01-10T14:23:45.123456",
      "source_doc_sha": "3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4",
      "concept_ids": ["graphene_001", "carbon_002", "material_003"],
      "session_id": "ingest_batch_20250110_001",
      "tags": ["physics", "materials_science"],
      "penrose_stats": {
        "n_concepts": 150,
        "n_edges": 342,
        "rank": 32,
        "threshold": 0.7,
        "density_pct": 0.3,
        "speedup_vs_full": 22.7
      },
      "metadata": {
        "source_path": "research/graphene_electronics.pdf",
        "concept_count": 150
      }
    }
  ]
}
